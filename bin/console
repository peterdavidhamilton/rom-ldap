#!/usr/bin/env ruby
#
# `$ LDAPHOST=x.x.x.x LDAPPORT=389 bundle exec ./bin/console`
#
# List every distinguished name
#   # => ldap.map(:dn).to_a
#
#
require 'bundler/setup'

require 'rom/ldap'
ROM::LDAP.load_extensions :compatibility

module Sandbox
  module_function

  def conf
    ROM::Configuration.new(:ldap) do |conf|
      conf.relation(:all) do
        schema('(objectClass=*)', infer: true)
      end
    end
  end

  def container
    ROM.container(conf)
  end

  def ldap
    container.relations[:all]
  end
end

include Sandbox

require 'pry'
Pry.start
